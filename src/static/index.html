<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="./styles.css">
    <script src="https://kit.fontawesome.com/e7e6177339.js" crossorigin="anonymous"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Journeymate</title>
</head>
<body onload="checkLogin()" id="body">

  <h1 class="page-top-text" style="font-family:'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;">Journeymate</h1>

    <div class="top-menu">

        <div class="menu">
            <a href="/" class="active">home<i class="fa-solid fa-house"></i></a>
            <a href="#" class="menu-right" onclick="document.getElementById('id01').style.display='block'">login</a>
            <a href="#" class="menu-right">menu</a>
            <a href="#" class="menu-right">questions</a>
        </div>
    </div>

    <!--<button onclick="document.getElementById('id01').style.display='block'" style="width:auto;">Login</button>-->

    <div id="id01" class="modal">
    
      <form class="modal-content animate" id="signinform">
        <div class="imgcontainer">
          <span onclick="document.getElementById('id01').style.display='none'; checkLogin()" class="close" title="Close Modal">&times;</span>
          <img src="./assets/img/avatar.png" alt="Avatar" class="avatar">
        </div>
    
        <div class="container">

          <label for="uname"><b>Username</b></label><br>
          <input id="lUsername" type="text" placeholder="Enter Username" name="username" required>
          <br>
          <label for="password"><b>Password</b></label><br>
          <input id="lPassword" type="password" placeholder="Enter Password" name="password" required>

          <button type="submit">Login</button>
          <button type="button" onclick="document.getElementById('id01').style.display='none'; document.getElementById('id02').style.display='block'">Sign Up</button>
          <label>
            <input type="checkbox" name="remember" id="lRemember"> Remember me
          </label>
        </div>
    
        <!-- <div class="container" style="background-color:#f1f1f1">
          <button type="button" onclick="document.getElementById('id01').style.display='none'" class="cancelbtn">Cancel</button>
          <span class="psw">Forgot <a href="#">password?</a></span>
        </div> -->
      </form>
    </div>

    <div id="id02" class="modal">
    
        <form class="modal-content animate" id="signupform">
          <div class="imgcontainer">
            <span onclick="document.getElementById('id02').style.display='none'; checkLogin()" class="close" title="Close Modal">&times;</span>
            <img src="./assets/img/avatar.png" alt="Avatar" class="avatar">
          </div>
      
          <div class="container">

            <label for="email"><b>E-mail</b></label><br>
            <input type="text" placeholder="Enter E-mail" name="email" required>
            <br>
            <label for="username"><b>Username</b></label><br>
            <input type="text" placeholder="Enter Username" name="username" required>
            <br>
            <label for="password"><b>Password</b></label><br>
            <input type="password" placeholder="Enter Password" name="password" id="Password" required>
            <br>
            <label for="password2"><b>Repeat Password</b></label><br>
            <input type="password" placeholder="Repeat Password" name="password" id="RepeatPassword" required>  
            <br>
            <label for="location"><b>Start locatie</b></label><br>
            <input type="text" placeholder="Enter start locatie" name="location" required>

            <button type="submit" onclick="">Sign Up</button>
            <button type="button" onclick="document.getElementById('id01').style.display='block'; document.getElementById('id02').style.display='none'">Login</button>
            <label>
              <input type="checkbox" name="remember"> Remember me
            </label>
          </div>
      
          <div class="container" style="background-color:#f1f1f1">
            <button type="button" onclick="document.getElementById('id01').style.display='none'; document.getElementById('id02').style.display='none'" class="cancelbtn">Cancel</button>
            <span class="psw">Forgot <a href="#">password?</a></span>
          </div>
        </form>
      </div>

      <div class="search" id="search-menu">
        <div class="search-form">
          <form id="locationForm">
            <label for="locationInput">Enter starting location:</label>
            <input type="text" id="locationInput" name="locationInput" required>
            <button type="submit" class="search-submit">Search</button>
          </form>
        </div>
        <div id="results" class="results">
          <div id="myDropdown" class="dropdown-content"></div>
          <div id="myDropdown2" class="dropdown-content" style="display: none;"></div>    
        </div>
      </div>


      <!-- <div id="question-menu">
      <div class="question-menu">
        <img src="./assets/img/card image.png" alt="Centered Image" class="question-image">
      </div>
      <div class="question-in-card">
        <a class="question-subject"><b>Onderwerp</b></a><br>
        <a class="question-text">test hoidaar eeeee test wat is dit voor een zin</a><br>
        <a class="new-question-button" href="#" onclick="getQuestion()">new question</a>
      </div> -->

      <div id="question-menu" class="question-menu">
        <img src="./assets/img/card image.png" alt="Centered Image" class="question-image">
        <div class="question-subject"><b>Zou je liever</b></div>
        <div class="question-text">Zou je liever tegen 1 grote eend vechten ter grootte van een paard of 100 paarden ter grootte van een eend?</div>
        <a class="new-question-button" href="#" onclick="getQuestion()">new question</a>
      </div>
      
      </div>
      <!-- <iframe src="./routes.html" class="search_frame"></iframe> -->

      <div class="bottom-menu">
        <a href="#" onclick="document.getElementById('search-menu').style.display = 'block'; document.getElementById('question-menu').style.display = 'none'; document.getElementById('id01').style.display='none'; document.getElementById('id02').style.display='none';" title="route"><i class="fa-solid fa-train"></i></a>
        <a href="#" onclick="document.getElementById('search-menu').style.display = 'none'; document.getElementById('question-menu').style.display = 'block'; document.getElementById('id01').style.display='none'; document.getElementById('id02').style.display='none';" title="questions in the train"><i class="fa-solid fa-circle-question"></i></a>
        <a href="#" id="settings-button" title="user settings"><i class="fa-solid fa-user"></i></a>
        <div id="dropup-menu" class="dropup-menu">
            <a href="#" onclick="document.getElementById('search-menu').style.display = 'none'; document.getElementById('question-menu').style.display = 'none'; document.getElementById('id01').style.display='none'; document.getElementById('id02').style.display='none';" title="settings"><i class="fa-solid fa-screwdriver-wrench"></i></a>
            <a href="#" onclick="document.getElementById('search-menu').style.display = 'none'; document.getElementById('question-menu').style.display = 'none'; document.getElementById('id01').style.display='block'; document.getElementById('id02').style.display='none';" title="sign-in"><i class="fa-solid fa-right-to-bracket"></i></a>
            <a href="#" onclick="document.getElementById('search-menu').style.display = 'none'; document.getElementById('question-menu').style.display = 'none'; document.getElementById('id01').style.display='none'; document.getElementById('id02').style.display='block';" title="sign-out"><i class="fa-solid fa-user-plus"></i></a>
        </div>
    </div>
</body>
<script src="script search.js"></script>
    <script src="script basic.js"></script>
    <script>
        function setCookie(cname,cvalue,exdays) {
          //console.log(cvalue);
          const d = new Date();
          d.setTime(d.getTime() + (exdays*24*60*60*1000));
          let expires = "expires=" + d.toUTCString();
          document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/;SameSite=Lax";
        }

        function getCookie(cname) {
          let name = cname + "=";
          let decodedCookie = decodeURIComponent(document.cookie);
          let ca = decodedCookie.split(';');
          for(let i = 0; i < ca.length; i++) {
            let c = ca[i];
            while (c.charAt(0) == ' ') {
              c = c.substring(1);
            }
            if (c.indexOf(name) == 0) {
              return c.substring(name.length, c.length);
            }
          }
          return "";
        }

        async function checkLogin() {
          let usernameResponse = await fetchWithToken("/api/user", {
            headers: {
              "Content-Type": "application/json",
              "Accepts": "application/json"
            },
            method: "GET"
          }).catch(e => {
            // check if the error is anythng other than unauthorized
            console.log(e);
          });

          /* let password = getCookie("password");*/
          if (usernameResponse.status === 200) {
            console.log("logged in");

            // parse username
            const responseJson = await usernameResponse.json();
            const username = responseJson.username;

            setCookie("username", username, 50);

            // hide login page
            document.getElementById('id01').style.display='none'
          } else {
            // show login page
            document.getElementById('id01').style.display='block'
          }
        }

        function ShowInput(){
          let input = document.getElementById("SearchPlace").value;
          alert(input);
        }

        function myFunction() {
          document.getElementById("myDropdown").classList.toggle("show");
        }

        // Close the dropdown if the user clicks outside of it
        window.onclick = function(event) {
          if (!event.target.matches('.dropbtn')) {
            var dropdowns = document.getElementsByClassName("dropdown-content");
            var i;
            for (i = 0; i < dropdowns.length; i++) {
              var openDropdown = dropdowns[i];
              if (openDropdown.classList.contains('show')) {
                openDropdown.classList.remove('show');
              }
            }
          }
        }

        async function fetchWithToken(url, config) {
          // inject stored token
          const token = getCookie("token");

          config.headers["Authorization"] = token;

          return fetch(url, config);
        }

        // const words = ["test1", "test2", "test3", "test4", "test5"];

        // // Get the parent element where the new elements will be appended
        // const element = document.getElementById("myDropdown");

        // // Loop through the array of words
        // for (let i = 0; i < words.length; i++) {
        //     // Create a new <a> element for each word
        //     const para = document.createElement("a");
            
        //     // Create a text node with the current word
        //     const node = document.createTextNode(words[i]);
            
        //     // Append the text node to the <a> element
        //     para.appendChild(node);
            
        //     // Optionally append a <br> element after each <a> element
        //     if (i < words.length - 1) { // Avoid appending <br> after the last word
        //         para.appendChild(document.createElement("br"));
        //     }

        //     // Append the <a> element to the parent element
        //     element.appendChild(para);
        // }
        // Array of button objects
        // const labels = [
        //     { id: "btn1", text: "Button1" },
        //     { id: "btn2", text: "Button2" },
        //     { id: "btn3", text: "Button3" },
        //     { id: "btn4", text: "Button4" }
        // ];
                
        // // Get the parent element where the buttons will be appended
        // const container = document.getElementById("myDropdown");
                
        // // Loop through the array of button objects
        // for (let i = 0; i < labels.length; i++) {
        //     // Create a new <button> element
        //     const button = document.createElement("button");
            
        //     // Set the text content of the button
        //     button.textContent = labels[i].text;
            
        //     // Optionally, set an ID for each button
        //     button.id = labels[i].id;
            
        //     // Add an event listener to each button
        //     button.addEventListener("click", function() {
        //         alert(`You clicked ${labels[i].text}`);
        //     });
            
        //     // Append the button to the parent element
        //     container.appendChild(button);
        // }

        document.getElementById('signupform').addEventListener('submit', async function(event) {
          // Prevent the form from submitting in the default way
          event.preventDefault();
          
          const form = event.target;
          const formData = new FormData(form);

          const data = {
            username: formData.get("username"),
            password: formData.get("password"),
            email: formData.get("email")
          };

          // session token
          // Send the data using fetch
          const response = await fetch("/api/auth/signup", {
            method: "POST",
            body: JSON.stringify(data),
            headers: {
                "Content-Type": "application/json",
                "Accepst": "application/json"
            }
          });

          if (response.status === 200) {
            // hide signup, show login
            document.getElementById('id02').style.display='none';
            document.getElementById('id01').style.display='block';
          }
      });

      document.getElementById('signinform').addEventListener('submit', async function(event) {
          // Prevent the form from submitting in the default way
          event.preventDefault();
          setCookie('test', "test", 100);
          const form = event.target;
          const formData = new FormData(form);

          const data = {
            username: formData.get("username"),
            password: formData.get("password"),
          };

          // session token
          // Send the data using fetch
          const response = await fetch("/api/auth/signin", {
            method: "POST",
            body: JSON.stringify(data),
            headers: {
                "Content-Type": "application/json",
                "Accepts": "application/json"
            }
          });

          if (response.status === 200) {
            const data = await response.json();

            setCookie("token", data.token, 1);

            document.getElementById('id01').style.display='none';
          } else {
            alert("could not sign in :( are you registered?");
          }
      });
    </script>
</html>